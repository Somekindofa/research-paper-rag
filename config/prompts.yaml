# Prompt Templates for Research RAG System
# =========================================

# Query Router - Decides if retrieval is needed
query_router:
  template: |
    You are a query classifier for a research paper RAG system. Analyze the user's query and determine if it requires searching the research paper database or can be answered directly.
    
    **Queries that need retrieval (respond with "retrieve"):**
    - Specific research questions about papers, methods, results, or findings
    - Questions asking for evidence, citations, or references
    - Requests to compare research approaches or summarize research
    - Domain-specific technical questions that require paper content
    
    **Queries that don't need retrieval (respond with "direct_answer"):**
    - Greetings (hello, hi, how are you)
    - General conversation or small talk
    - Questions about the system itself (how do you work, what can you do)
    - Very general knowledge questions not requiring research papers
    - Follow-up acknowledgments (thank you, okay, got it)
    
    Query: {query}
    
    Respond in JSON format:
    {{
      "needs_retrieval": true or false,
      "reasoning": "brief explanation"
    }}
    
    JSON response:

# Direct Answer - For queries without retrieval
direct_answer:
  template: |
    You are a helpful AI research assistant. Answer the user's query directly without using the research paper database.
    
    Be conversational and friendly. If the query is a greeting, respond warmly. If it's a general question about the system, explain your capabilities.
    
    Your capabilities:
    - Search and analyze research papers in the indexed database
    - Generate answers with academic citations
    - Use HyDE (Hypothetical Document Embeddings) for better retrieval
    - Rerank results for relevance
    
    Query: {query}
    
    Response:

# HyDE (Hypothetical Document Embeddings) Prompt
# Generates a hypothetical academic paragraph that would answer the query
hyde:
  template: |
    You are an expert academic researcher. Given a research question, write a detailed academic paragraph (150-200 words) that would appear in a research paper answering this question. Use formal academic language, include specific technical terms, and write as if this is an excerpt from a real published paper.
    
    Research Question: {query}
    
    Academic Paragraph:

# Synthesis/Generation Prompt
# Generates final answer with citations from retrieved sources
synthesis:
  template: |
    You are a research assistant helping to answer questions based on academic papers. Use ONLY the information from the provided sources to answer the question. 
    
    IMPORTANT CITATION RULES:
    - Cite sources using [Author, Year] format inline
    - Every claim must have a citation
    - If sources don't contain enough information, say so clearly
    - Do not make up information not present in sources
    
    Question: {query}
    
    Sources:
    {sources}
    
    Provide a comprehensive, well-cited answer:

# Source Formatting Template
source_format:
  template: |
    [Source {index}]
    Title: {title}
    Authors: {authors}
    Year: {year}
    Relevant Excerpt: {content}
    ---

# Query Preprocessing Prompt (optional, for complex queries)
preprocess:
  template: |
    Rewrite the following research question to be more specific and searchable. Keep the core intent but add relevant academic terminology.
    
    Original: {query}
    
    Improved query:

# Metadata Extraction Prompt
metadata_extraction:
  template: |
    Analyze this research paper excerpt and provide concise metadata in JSON format.
    
    Title: {title}
    
    Excerpt:
    {text_sample}
    
    Provide the following metadata (each in 1-2 sentences):
    1. summary: Brief overview of the paper
    2. gap: Research gap or problem addressed
    3. methodology: Research methods used
    4. results: Key findings
    5. discussion: Main interpretations
    6. conclusion: Main takeaways
    
    Return ONLY valid JSON with these keys: summary, gap, methodology, results, discussion, conclusion
